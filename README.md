# 暗影试炼：轮回地牢（Shadow Trials: Rebirth Dungeon）

![游戏图标](icon.png)

[![License: MIT](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
![Engine](https://img.shields.io/badge/engine-Godot%204.5-blue.svg)
![Language](https://img.shields.io/badge/language-GDScript-purple.svg)
![Status](https://img.shields.io/badge/status-WIP-orange.svg)
![Target](https://img.shields.io/badge/target-Steam%20PC-black.svg)

俯视角暗黑风肉鸽 ARPG / 幸存者风格学习与实践项目，目标是做成一款可以真正上线 Steam 的小体量精品：在随机生成的地牢中战斗、掉落与成长，每一次死亡都让你变得更强。

---

## 项目定位与目标

- **中文游戏名**：暗影试炼：轮回地牢  
- **英文游戏名**：Shadow Trials: Rebirth Dungeon  
- **玩法标签**：顶视角 / ARPG / Roguelite / 幸存者风格 / 暗黑风 / 单机  
- **项目性质**：开源学习工程 + 最终可发行的完整游戏  
- **开源协议**：MIT License（见下文「许可证」章节）

本仓库不仅是个人/团队练习 Godot 4.5、ARPG 与肉鸽设计的系统案例，也会尽量按照正式商业项目的标准来设计架构、文档与内容生产流程，方便未来导出到 Steam 及其他平台。

---

## 开源说明

- 本项目以 MIT 协议开源，任何人都可以在遵守协议的前提下学习、修改、分发和用于商业项目。  
- 欢迎通过 Issue / PR 反馈问题、提出新想法或贡献代码与文档。  
- 适用场景包括：个人技术练习、课程与直播示例、项目脚手架（二次创作时请保留许可证声明）。

---

## 当前实现进度概览

> 本仓库目前处于**早期原型阶段**。README 中很多章节是“目标架构 + 学习路线蓝图”，并未全部在代码中落地。本节总结当前实际已实现的功能与尚未实现的部分，方便你快速对齐预期。

**已实现的主要功能**

- **入口与场景**
  - `project.godot` 中 `run/main_scene` 指向 `core/main.tscn`。  
  - `core/main.tscn` 是一个测试场景：包含地面、一个玩家角色和若干静态放置的敌人，用于验证移动、冲刺和自动攻击。
- **玩家（features/player）**
  - `features/player/player.tscn`：`CharacterBody3D` + `SpringArm3D/Camera3D`，实现俯视相机跟随。  
  - `features/player/player.gd`：实现
    - 基于 `move_left/move_right/move_forward/move_back` 的相机相对移动；
    - `dash` 冲刺（带持续时间和冷却）；
    - 通过 `Area3D` 近战范围检测的**自动攻击**（冷却由属性控制）；
    - 自动朝向当前攻击目标或移动方向。
- **敌人（features/enemies）**
  - `features/enemies/enemy.tscn`：简单的盒子敌人，挂载 `CharacterBody3D`。  
  - `features/enemies/enemy.gd`：敌人持有一份 `character_stats`，实现
    - `take_damage(damage_amount)`：扣减生命值并打印调试信息；
    - 生命值小于等于 0 时调用 `die()`，并 `queue_free()` 自毁。
- **共享属性资源（features/shared/resources）**
  - `features/shared/resources/character_stats.gd`：声明 `Resource` `character_stats`，包含
    - `max_health`、`attack_power`、`attack_interval`；
    - 运行时变量 `current_health`；
    - `health_changed` 信号（当前仅在敌人上预留，尚未接 UI）。
  - 玩家与敌人的属性都通过该 Resource 配置，玩家的攻击间隔和伤害直接读取自 `stats`。
- **输入映射与碰撞层（project.godot）**
  - 已在 `project.godot` 中配置：`move_*`、`dash`、`skill_1`、`skill_2`、`interact`、`open_inventory`、`open_map`、`pause` 等输入动作，其中当前脚本实际使用的是移动 + `dash`。  
  - 3D 物理层名称已配置前 4 层：`player` / `ground` / `enemy` / `player_hitbox`，并在 `core/main.tscn`、`player.tscn`、`enemy.tscn` 中实际使用。

**尚未实现 / 仅有目录或设计的模块**

- `core/main.gd`、`core/globals.gd`、`core/scene_manager.gd`：文档中作为目标架构存在，当前仓库中**尚未创建**，场景切换与全局配置也尚未抽象为 Autoload。  
- `data/characters`、`data/items`、`data/skills`：当前为空目录，尚未有实际 `.tres` 数据资产。  
- `features/combat/`、`features/inventory/`、`features/procedural_generation/`、`features/ui/`：仅创建了目录（部分目录甚至为空），README 中对这些模块的描述属于未来规划。  
- `features/shared/components/`、`features/shared/state_machine/`：目前仅存在 `resources/character_stats.gd`，其余通用组件/状态机未实现。  
- `docs/`、`tests/`、`tools/`：当前为空；README 中提到的 `docs/changelog.md`、打包脚本等还没有落地。  
- `export_presets.cfg`：项目还未创建导出预设，该文件在仓库中不存在。  
- 学习路线中第 3 阶段及之后的内容（完整战斗系统、掉落/背包、程序化关卡、存档与元进度、Steam 集成等）目前都还**没有对应的实现代码**。

阅读后续章节时，可以将其理解为“目标设计文档 + 未来路线图”，以本节为基准判断哪些内容已经在代码中出现、哪些仍处于规划阶段。

---

## 俯视 ARPG 肉鸽项目学习与实践手册（Godot 4.5）

本仓库用于系统学习与实现一个俯视视角的暗黑类（ARPG 风格）、偏幸存者玩法（大量敌人 + 自动或半自动输出）的肉鸽游戏。目标是以模块化、数据驱动的方式搭建核心循环（移动 - 战斗 - 掉落 - 成长 - 关卡推进），并兼顾易扩展与可维护性。

本文既是整体设计文档，也是后续开发与自学 Godot 的执行手册：从 0 基础跑通第一个场景，逐步完成竖切 Demo，最终将游戏打磨到可在 Steam 上架的质量。

### 适合人群 & 前置建议

- 有一定编程基础（任意语言皆可），希望系统学习 Godot 4 + GDScript。  
- 喜欢暗黑、肉鸽、幸存者类游戏，想做一款“自己也愿意玩很多局”的小体量作品。  
- 接受“边做边学”的路径：不是先把 Godot 所有教程看完，而是在做这个项目的过程中查缺补漏。

**目录**
- 项目结构（目标与演进）
- 开发环境与运行
- 输入映射约定
- 架构与模块划分
- 移动与相机（俯视 ARPG）
- 物品与词缀（数据驱动）
- 战斗与碰撞（层与掩码）
- 程序化关卡（房间模板）
- UI/HUD 规范
- 存档与配置
- 代码风格与命名
- 性能与调试
- 导出与版本
- 学习路线与里程碑（Godot + 暗黑肉鸽幸存者）

---

## 项目结构（目标与演进）

目标结构（当前工程会逐步演进至此）：

```text
/project_root
|
|-- addons/                  # Godot 插件目录。存放从外部获取的插件。
|
|-- assets/                  # 原始、非代码资源目录（美术、音频的源文件，如 .blend, .psd, .wav）。
|   |-- environments/        # 3D 环境模型、材质、纹理的源文件。
|   |-- vfx/                 # 视觉特效的源文件（序列帧、噪声图等）。
|   `-- audio/               # 音频源文件，可再细分为 music/ 和 sfx/。
|
|-- core/                    # 核心代码与全局逻辑目录。游戏的启动和基础框架。
|   |-- main.tscn            # 游戏主入口场景，负责加载全局单例和过渡到主菜单。
|   |-- main.gd              # main.tscn 的附加脚本。
|   |-- globals.gd           # 全局单例（Autoload），用于存放全局配置、工具函数等。
|   `-- scene_manager.gd     # 场景切换管理器（Autoload），处理场景加载和过渡。
|
|-- data/                    # 游戏数据资源目录（Godot Resource 定义，如 .tres, .res）。
|   |
|   |-- characters/          # 存放角色数据定义
|   |   |-- player_classes/  # 玩家职业/角色定义
|   |   |-- enemy_types/     # 敌人类型定义
|   |   `-- npcs/            # NPC 定义
|   |
|   |-- items/               # 物品数据（基础定义、词缀、独特物品等）。
|   |   |-- bases/           # 基础物品类型定义（如：剑、头盔）。
|   |   |-- affixes/         # 词缀数据（如：“火焰的”、“迅捷的”）。
|   |   `-- uniques/         # 独特/传奇物品的定义。
|   |
|   `-- skills/              # 技能数据。
|
|-- features/                # 功能模块目录（核心）。各模块高内聚、低耦合。
|   |-- player/              # 玩家角色（控制器、状态机、场景等）。
|   |-- enemies/             # 敌人相关（AI、种类定义、场景等）。
|   |-- combat/              # 战斗系统（伤害计算、状态效果、弹道逻辑等）。
|   |-- inventory/           # 库存系统。
|   |-- procedural_generation/ # 程序化生成逻辑（地图、关卡等）。
|   |
|   |-- ui/                  # UI 模块
|   |   |-- hud/             # 游戏主界面（HUD）。
|   |   |-- main_menu/       # 主菜单界面。
|   |   |-- settings/        # 设置界面。
|   |   `-- components/      # 可复用的 UI 组件（如自定义按钮、血条、弹出窗口）。
|   |
|   `-- shared/              # 跨模块共享的通用组件或场景。
|       |-- components/      # 可复用的节点组件（如：生命值组件、拾取范围）。
|       |-- resources/       # 存放共享的 Resource 定义脚本
|       `-- state_machine/   # 通用的状态机实现。
|
|-- localization/            # 本地化/多语言目录。存放翻译文件（如 .csv, .po）。
|
|-- shaders/                 # 着色器代码目录（.gdshader 文件）。
|   |-- post_processing/     # 后处理效果着色器。
|   |-- materials/           # 用于材质的着色器。
|   `-- particles/           # 用于粒子系统的着色器。
|
|-- docs/                    # 文档目录（设计、规范、研究记录等）。
|
|-- tests/                   # 自动化测试目录（如 GUT, WAT 测试脚本）。
|
|-- tools/                   # 外部工具和脚本目录（如：资源导入器、批处理脚本）。
|
|-- .gitignore               # Git 版本控制忽略文件，务必包含 .godot/ 目录。
|
|-- project.godot            # Godot 项目主配置文件。
|
`-- export_presets.cfg       # 导出预设配置文件（创建导出模板后自动生成）。
```

新增模块时优先放在 `features/<domain>/`，避免把领域逻辑堆在 `core/`。

## 开发环境与运行

- Godot 版本：4.5（渲染：Forward+）。
- 打开方式：启动 Godot，选择本仓库根目录；或命令行 `godot4 --path .`。
- 运行游戏：在 Godot 中按 `F5`，默认入口为 `core/main.tscn`（如有调整以项目设置为准）。
- 导出配置：在 Godot 中通过“项目 -> 导出”维护，保存到 `export_presets.cfg`，不建议手动编辑该文件。

## 输入映射约定

幸存者类玩法的核心是“主要通过走位决策”，基础攻击多为自动或半自动释放。为此，本项目的输入映射尽量保持精简，让你在键盘和手柄上都能“少按键，多走位”。

> 说明：不需要也不建议修改或删除 Godot 默认的 `ui_*` 输入映射（`ui_accept`、`ui_cancel` 等），本项目只是在此基础上**新增**一组动作名称，用于游戏逻辑。

### 核心动作（推荐至少配置）

- 移动：`move_left` / `move_right` / `move_forward` / `move_back`  
- 闪避/短位移：`dash`  
- 主动技能：`skill_1`、`skill_2`（少量高影响力技能，例如“冲刺斩”“爆发技”等）  
- 交互：`interact`（开门、拾取、对话等）  
- 系统：`open_inventory`、`open_map`、`pause`  
- UI 导航：沿用 Godot 默认 `ui_accept` / `ui_cancel` / `ui_up` / `ui_down` / `ui_left` / `ui_right`

说明：  
- 基础攻击、被动技能、自动释放的火力等，推荐全部由内部逻辑根据时间、范围和 Build 配置来决定，不需要单独的输入动作。  
- 如需更复杂的玩法（如半自动强制开火、额外技能栏），可以在后期再扩展更多动作。

### 可选扩展动作（半自动/高阶操作需要时再添加）

- `skill_3`、`skill_4`：额外主动技能槽位。  
- `attack_manual`：半自动模式下，强制立即释放一次基础攻击。  
- `lock_target`：锁定/切换目标（如果引入锁定系统）。  
- `open_character`：单独的角色/属性面板（也可以和背包合并为一个界面）。

### 核心动作 + 默认绑定一览（建议在 Input Map 中按此配置）

| 动作名           | 用途                     | 键盘/鼠标默认               | 手柄默认（Xbox/PS）          |
| ---------------- | ------------------------ | --------------------------- | ---------------------------- |
| `move_forward`   | 向前移动                 | W / ↑                       | 左摇杆前                     |
| `move_back`      | 向后移动                 | S / ↓                       | 左摇杆后                     |
| `move_left`      | 向左移动                 | A / ←                       | 左摇杆左                     |
| `move_right`     | 向右移动                 | D / →                       | 左摇杆右                     |
| `dash`           | 闪避 / 短距离位移        | Space                       | B / Circle                   |
| `skill_1`        | 主动技能 1               | Q                           | X / Square                   |
| `skill_2`        | 主动技能 2               | E                           | Y / Triangle                 |
| `interact`       | 拾取 / 开门 / 对话等交互 | F                           | A / Cross                    |
| `open_inventory` | 打开/关闭背包            | Tab                         | View / Select                |
| `open_map`       | 打开/关闭地图            | M                           | 十字键上（D-Pad Up）         |
| `pause`          | 暂停 / 打开暂停菜单      | Esc                         | Menu / Options               |
| `ui_accept`      | UI 确认                  | Enter / Space（Godot 默认） | A / Cross（Godot 默认映射）  |
| `ui_cancel`      | UI 取消/返回             | Esc / Backspace（默认）     | B / Circle（Godot 默认映射） |

你可以在 Godot 的「项目设置 -> 输入映射」中按上述表格添加/检查这些动作。

## 架构与模块划分

本节描述的是**目标架构蓝图**，用于规划各模块在成熟状态下的职责与边界。

- **Core（引导与单例）**
    - `core/main.tscn`：游戏主入口场景，负责挂载主菜单 / 首个关卡，以及初始化全局单例。  
    - `main.gd`：入口脚本，用于统一初始化流程、读取配置、处理启动参数（如调试模式）等。  
    - `globals.gd`：全局单例（Autoload），负责配置常量、随机数种子、全局事件总线、通用工具方法等。  
    - `scene_manager.gd`：场景切换管理器（Autoload），抽象场景加载、过场动画、淡入淡出、关卡切换与存档点恢复等流程。

- **Features（领域模块）**
    - `player/`：
      - 负责玩家角色的输入适配（键鼠/手柄）、移动与冲刺、战斗触发（近战/远程/技能）、动画状态机，以及与属性和 Buff 的交互。  
    - `enemies/`：
      - 定义各种敌人类型与行为：感知（Ray/Area）、追击/巡逻/攻击/撤退的 AI 逻辑，以及死亡流程与掉落钩子。  
    - `combat/`：
      - 集中处理战斗系统：伤害计算（基础值 + 加成）、抗性、命中/暴击/闪避判定、敌我阵营识别、硬直与无敌帧、浮动伤害数字等。  
    - `inventory/`：
      - 管理背包与装备槽，负责属性汇总（基础属性 + 装备 + Buff）、掉落拾取、装备替换，以及与 `data/items` 数据定义的映射。  
    - `procedural_generation/`：
      - 封装程序化关卡逻辑：房间模板拼接（入口/出口锚点）、钥匙/门机制、战斗房/事件房/精英/商店等房间类型，以及整局关卡进度与难度曲线控制。  
    - `ui/`：
      - 包含 HUD、主菜单、设置面板、背包与角色面板、工具提示、数值飘字等 UI 层逻辑，负责展示数据和响应用户操作。  
    - `shared/resources/`：
      - 存放可复用的 Resource 定义（如角色属性卡、技能/状态配置、掉落表等），作为数据驱动的基础。  
    - `shared/components/`、`shared/state_machine/`：
      - 跨模块通用的节点组件（生命值组件、拾取范围、定时器组件等）与可复用的状态机实现（用于玩家、敌人或技能逻辑）。

原则：UI 只展示数据，不直接驱动核心逻辑；核心逻辑对 UI 无依赖，通过事件、信号或数据绑定进行解耦。

## 移动与相机（俯视 ARPG）

- 角色在 XZ 平面自由移动，不强调跳跃（可根据设计启用/禁用）。
- 配置项：推荐使用 `move_relative_to_camera = true`，提供“相机相对”移动体验。
- 相机结构：`SpringArm3D/Camera3D`，俯视角固定或轻微跟随主角。
- 角色朝向：
  - 默认朝向移动方向。
  - 后续可扩展“朝向鼠标”或“右摇杆指向”。

## 物品与词缀（数据驱动）

- 物品数据存放路径：`data/items/{bases,affixes,uniques}/*.tres`。
- 推荐结构：
  - **基础物品（Base）**：部位类型、基础数值（伤害、攻速、范围）、可滚词缀槽位。
  - **词缀（Affix）**：前/后缀、权重、数值区间、档位（T1–T5）。
  - **实例（ItemInstance）**：根据关卡进度和“幸运值”等因子抽取并固化最终数值。
- 技能资源：`data/skills/*.tres`，字段包含冷却、施法时间、消耗、投射体/范围参数、受属性加成标签等。

## 战斗与碰撞（层与掩码）

在「项目设置 -> 物理 -> 3D -> 层名称」中建议配置：

1. player
2. ground
3. enemy
4. player_hitbox（玩家伤害盒/投射物）
5. enemy_hitbox
6. environment
7. loot
8. interactable
9. sensor（感知/触发区）

实现要点：

- 命中框与受击框分离（`Area3D + CollisionShape3D`），通过信号回调进行结算。
- 投射体使用对象池复用；命中或超出范围后回收；可参数化穿透、弹射等行为。
- 受击反馈统一交由 `combat` 中心逻辑处理（硬直、击退、无敌帧、浮动伤害数字等）。

## 程序化关卡（房间模板）

- 模板路径：`features/procedural_generation/room_templates/` 用于保存可拼接房间（约定入口/出口锚点）。
- 生成器职责：
  - 根据进度生成“走廊 - 战斗 - 事件 - 奖励”等房间序列。
  - 控制稀有度、精英怪、商店、秘境等权重。
  - 确保房间连接合法（不自交、不出现死路或无法抵达的出口）。

## UI/HUD 规范

- HUD 内容：血量、资源（怒气/法力）、经验条、技能栏、Buff/状态图标、战斗浮动信息。
- 交互提示：物品拾取提示（对准/自动/按键）、装备对比（提升为绿色、降低为红色）。
- 工具提示：从 `data/` 中的资源动态拼装（例如范围、冷却、伤害标签、词缀效果）。
- UI 组件集中在 `features/ui/components/`，便于复用和统一风格。

## 存档与配置

- 存档技术选型：
  - 轻量数据：`FileAccess` + JSON。
  - 大量结构化数据：`ResourceSaver` 保存为 `*.tres`。
- 存档内容：
  - 当前 Build（装备、技能、天赋）。
  - 关卡进度（层数、种子、难度）。
  - 用户设置（音量、按键、画质、语言等）。
- 推荐通过 `globals.gd` 暴露统一的 `save_game()` / `load_game()` 接口，并管理本局随机种子。

## 代码风格与命名

- GDScript：
  - 4 空格缩进，UTF-8 编码。
  - 尽量使用类型标注，便于补全和静态检查。
  - 避免在 `_process` 中堆积复杂逻辑，优先用状态机与信号拆分。
- 命名约定：
  - 场景：`pascal_case.tscn`
  - 类名：`pascal_case`
  - 脚本文件：`snake_case.gd`
  - 信号：`something_happened`
  - 常量/枚举：`SCREAMING_SNAKE_CASE`
- 资源与数据：
  - `*.tres` 只存数据，不耦合节点树；脚本读取数据并实例化场景或对象。
- 物理：
  - 清晰配置碰撞层/掩码；避免 Player 直接检测 EnemyHitbox 之外的无关层。

## 性能与调试

- 对象池：对投射体、掉落物、临时特效等频繁创建/销毁的节点进行池化。
- 导航：仅在需要的房间构建 NavMesh，离开房间后及时释放。
- 资源体积：控制贴图分辨率（优先 1K–2K），合理使用压缩和独立的法线/粗糙度贴图。
- 调试工具：
  - `VisibleCollisionShapes`、`DebugDraw`、`NavigationServer` 可视化路径。
  - `RenderingDebugger` 查看渲染瓶颈。

## 美术与音效（Art & Audio）

> 目标：以“技术能承受、制作成本可控”为前提，做出风格统一、读数清晰的暗黑风幸存者地牢。

### 美术方向与资源规划

- **风格定位**：偏低多边形 / 体块感强的 3D，搭配偏暗环境 + 强对比光源，突出技能与敌人轮廓。  
- **优先级排序**（从高到低）：
  - 读数优先：玩家、敌人、投射体的形状和颜色要一眼可辨。  
  - 技能与危险区：范围提示、投射物轨迹、AOE 区域要清晰。  
  - 环境细节：地砖、石柱、路边装饰可以简化，用贴图和光影弥补。  
- **目录约定**：
  - 原始资源：`assets/environments/`、`assets/vfx/`、`assets/audio/`  
  - 导入后场景/材质/网格：放在对应的 `features/` 子目录中（例如敌人模型和材质放在 `features/enemies/` 内部）。  
- **实践建议**：
  - 统一色彩基调：环境偏冷/暗，玩家和关键技能适度提亮（高饱和度），敌人根据危险程度使用不同亮度。  
  - 分层制作：先用“灰盒（灰色立方体）”搭结构和节奏，再逐步替换为正式模型与贴图。  
  - 善用 Godot 自带资源：内置 Primitive Mesh、标准材质和粒子系统即可做出足够好的原型效果。

### 概要动画与特效（VFX）

- 玩家和敌人至少提供：待机、移动、攻击、受击/死亡 几种基础状态，可先用简单补间或动画混合实现。  
- 技能特效优先做清楚的“前摇提示 + 命中反馈”，不要一开始就追求复杂粒子。  
- 统一将特效资源（纹理/噪声图等）放在 `assets/vfx/`，实例化的粒子节点可以放在 `features/shared/components/`。

### 音效与音乐（SFX & BGM）

- **功能定位**：
  - BGM：营造“压抑但不吵”的地牢氛围，可少量循环曲目。  
  - SFX：突出关键反馈——攻击击中、受伤、拾取、升级/解锁、UI 交互。  
- **资源来源建议**：
  - 初期可使用开源/免费音效库（需注意授权和署名），后期逐步替换成自制或购买资源。  
  - 所有原始音频放在 `assets/audio/{music,sfx}/`，导入后在 Godot 内通过 `AudioStreamPlayer`/`AudioStreamPlayer3D` 统一管理。  
- **技术实践**：
  - 在 `core/` 或 `features/shared/` 中维护一个简单的 `AudioManager`，提供 `play_sfx()`、`play_bgm()` 之类的接口，避免到处散落播放器节点。  
  - 控制长度与动态范围：攻击/受击音效保持短促干脆，避免与 BGM 混在一起听不清。  
  - 预留音量设置：将 BGM 和 SFX 音量以总线（Bus）方式管理，便于在设置界面统一调节。

### 首批资产清单（最小可玩集）

为方便边学边做，建议先完成一套“最小可玩”的美术与音频资产，用于阶段 2–4 的竖切 Demo。

**美术（Art）最小集**：
- 玩家：
  - 1 个玩家模型（低多边形 / 体块感强）。  
  - 动画：待机、跑步、普攻、受击、死亡。  
  - 1 组简单角色头像/小图标（用于 HUD）。  
- 敌人（至少 3 种）：
  - 近战小怪：模型 + 待机/跑步/攻击/死亡。  
  - 远程小怪：模型 + 待机/跑步/施法/死亡。  
  - 精英/冲锋怪：模型 + 冲锋/蓄力动作 + 死亡。  
- 技能与特效（VFX）：
  - 近战挥砍特效（刀光/能量弧）。  
  - 投射物特效（火球/暗影弹）。  
  - 范围技能特效（地面圈 / 爆炸）。  
  - 受击闪光/“喷血”替代特效。  
- 场景与环境：
  - 地牢地面瓦片若干（破损、血迹、符文等简单变体）。  
  - 墙体/柱子/障碍物 3–4 种（石柱、箱子、牢笼等）。  
  - 门/传送门模型各 1 个。  
- 掉落与 UI 图标：
  - 掉落物模型：经验结晶、金币/魂、宝箱。  
  - 基础装备图标：武器 3 个、护甲 2 个、饰品 2 个。  
  - UI 通用图标：技能栏格子、背包格子、升级/加点按钮。  

**音频（Audio）最小集**：
- BGM：
  - 战斗循环 BGM 1 条（地牢氛围）。  
  - 菜单/休息 BGM 1 条（节奏更平缓）。  
- 玩家相关 SFX：
  - 轻攻击、重攻击 各 1–2 个音效。  
  - 受伤音效 1–2 个。  
  - 冲刺/翻滚音效 1 个。  
  - 升级/解锁提示音效 1 个。  
- 敌人相关 SFX：
  - 敌人攻击音效（近战/远程 各 1 个）。  
  - 敌人受击音效 1 个。  
  - 敌人死亡音效 1 个（可多怪共用）。  
- 技能与环境 SFX：
  - 投射物发射音效 1 个，命中音效 1 个。  
  - 范围技能启动/爆炸音效 各 1 个。  
  - 掉落/拾取物品音效 1 个。  
  - 环境循环音效 1–2 个（风声、滴水等）。  
- UI SFX：
  - 按钮点击、确认、取消 各 1 个。  
  - 弹出/关闭面板音效 各 1 个。  

在“学习路线与里程碑”章节中，会分阶段引用这份清单，作为阶段 2–4 和阶段 7 的美术/音频验收标准。

## 导出与版本

- 在 Godot 中通过「项目 -> 导出」添加目标平台预设，保存生成 `export_presets.cfg`。
- 建议采用语义化版本号：`major.minor.patch`。
- 可在 `docs/changelog.md` 中维护简要更新日志（版本、日期、主要改动）。

## 贡献指南

- 提交代码前请阅读并遵循其中的目录结构与代码风格约定。  
- 建议工作流程：
  - Fork 本仓库并创建特性分支（例如 `feat/combat-crit`）。  
  - 在 Godot 4.5 中运行 `core/main.tscn`，确认主流程可用且新功能正常工作。  
  - 提交 Pull Request 时简要说明改动内容、测试方式，以及相关截图或 GIF（如适用）。  
- 欢迎贡献内容包括：玩法与数值实验、战斗与关卡系统、程序化生成、UI/UX、性能优化、文档与本地化等。

## 学习路线与里程碑（俯视 ARPG）

建议按以下阶段推进，每一步都产出可运行的“小竖切”，并对应到本仓库的目录结构。

> 如果你是 **完全没用过 Godot** 的初学者，可以先从阶段 0 开始；已经有一点 Godot 经验，可以直接从阶段 1 或 2 起步。

### 阶段 0：Godot & GDScript 基础打底

**目标**：安装并熟悉 Godot 4.5 的基本概念，能看懂并轻度修改本项目脚本。  
**建议输出**：
- 完成官方文档里的入门教程（至少一个 2D 或 3D 小 Demo）。  
- 在本项目中成功打开工程并运行 `core/main.tscn`。  
- 熟悉以下概念：Scene/Node、脚本挂载、信号、输入映射、导出项目的基本流程。

**推荐练习**（可以在一个单独小工程中完成）：
- 写一个简单的“移动方块”场景：键盘 WASD 控制一个节点移动。  
- 使用信号控制 UI：按键时在 `Label` 上显示提示文字。  
- 把场景导出成一个可执行文件（任何平台皆可）。

### 阶段 1：俯视移动与相机（空场景竖切）

**目标**：在本仓库中实现一个“只有移动与相机”的可玩空场景，为后续战斗/刷怪打基础。  
**仓库落点**：
- `features/player/`：玩家控制器、输入映射适配。  
- `core/main.tscn`：确保能从入口进入测试场景。  

**里程碑**：
- 键鼠 / 手柄可以控制角色在 XZ 平面移动。  
- 俯视相机平滑跟随角色，不穿帮、不晃眼。  
- 角色朝向移动方向（后续可以扩展为朝向鼠标或右摇杆）。

完成标准：你可以邀请一个朋友，只用“移动 + 相机”在空房间里跑几圈，手感不别扭。

### 阶段 2：幸存者核心循环雏形（刷怪 + 自动输出）

**目标**：先做出偏“幸存者”的基础循环：大量敌人缓慢刷出，角色自动或半自动攻击。  
**仓库落点**：
- `features/enemies/`：基础敌人场景 + 简单 AI（追击/靠近）。  
- `features/combat/`：简单伤害结算、冷却、攻击范围探测。  

**关键点**：
- 敌人分批刷新、缓慢靠近玩家。  
- 玩家自动或按住按键持续攻击（如环绕弹幕、自动挥砍）。  
- 敌人被击败后消失并留下一些可视反馈（简单特效或闪白即可）。

**美术/音频要求**（可选，建议使用灰盒）：  
- 此阶段可以完全使用立方体/胶囊体作为玩家和敌人，仅用简单颜色区分阵营。  
- 音效可暂用免费占位资源或简单“哔声”，重点先保证节奏与数值循环。  

**里程碑**：能玩一局“活到第 X 波”的小 Demo，即使画面丑陋也无所谓。

### 阶段 3：ARPG 手感与基础战斗系统

在幸存者循环雏形的基础上，引入更多 ARPG 手感：

- **基础战斗**：近战轻/重击、命中判定、伤害数字、受击闪白和硬直。  
- **投射体技能**：火球/箭矢类技能，包含冷却、消耗、命中/穿透规则。  
- **受击与死亡流程**：玩家/敌人死亡动画、重生或重新开始一局。

**仓库落点**：
- `features/combat/`：伤害计算、暴击/格挡、敌我阵营识别。  
- `features/shared/components/`：生命值组件、受击组件等可复用逻辑。

**美术/音频要求**（对应首批资产清单的子集）：  
- 玩家至少使用“玩家模型 + 待机/跑步/普攻/受击/死亡”动画中的一部分，替换掉完全的灰盒。  
- 为基础攻击和受击事件接入 1–2 个 SFX，并为命中/受伤配套简单 VFX（例如刀光与受击闪光）。  

里程碑：一局游戏中，攻击-受击-死亡-重新开始形成闭环，且基础打击感（动画 + VFX + SFX）可感知。

### 阶段 4：掉落、背包与属性成长（肉鸽化）

**目标**：让每局游戏“越打越强”，感受到明显成长曲线。  
**仓库落点**：
- `data/items/{bases,affixes,uniques}/`：基础物品、词缀与独特物品的定义。  
- `features/inventory/`：背包、装备栏、属性统计。  
- `features/ui/hud/`：简单背包 UI、拾取提示、装备对比展示。

**建议步骤**：
- 敌人死亡掉落基础物品（武器、防具或被动饰品）。  
- 玩家可拾取并装备，立刻改变攻速/伤害/范围或其他关键属性。  
- 引入最少量的词缀，例如“+X% 攻击力”、“+Y% 移动速度”。  

**美术/音频要求**（对应首批资产清单的子集）：  
- 为掉落物和基础装备准备最小集的模型与图标（经验结晶、金币/魂、3 个武器图标等）。  
- 为拾取、装备变化、升级事件接入简单 SFX，使成长反馈更明显。  
- HUD 中使用基础的技能栏/背包格子图标，保证读数清晰。  

里程碑：玩家可以明显感觉到“这把装备起来之后更强了”，愿意为掉落而继续战斗，同时基础成长反馈（音效 + 图标 + 掉落表现）完整可感知。

### 阶段 5：敌人 AI、多样性与关卡推进

**目标**：让每一局体验更丰富，避免只有“同一种怪 + 无尽刷怪”。  
**仓库落点**：
- `data/characters/enemy_types/`：敌人类型数据与行为参数。  
- `features/enemies/`：不同敌人场景与 AI 逻辑。  
- `features/procedural_generation/`：房间模板与关卡推进逻辑。

**建议内容**：
- 至少 3–5 种敌人：普通怪、远程怪、冲锋怪、召唤怪等。  
- 基本行为：巡逻 / 追击 / 攻击 / 撤退 / 特殊技能。  
- 简单关卡结构：清理当前房间 → 选择下一个房间类型（战斗/商店/事件）→ 前进。

里程碑：一局游戏中会体验到不同节奏的战斗房间，而不是单一“刷怪广场”。

### 阶段 6：程序化房间与元进度（Roguelite 完整循环）

**目标**：将关卡和成长系统肉鸽化，让“多次轮回”有意义。  
**仓库落点**：
- `features/procedural_generation/room_templates/`：多种房间模板与连接规则。  
- `data/skills/` 与部分 `data/items/`：解锁池与权重调整。  
- 存档相关逻辑（见下文“存档与配置”）。

**关键点**：
- 每局使用不同的随机种子生成房间序列（可通过 debug 输出观察）。  
- 增加元进度：某些物品/技能需要累计若干局或完成特定成就后解锁，加入掉落池。  
- 支持基础存档：记录解锁状态、最高层数、若干关键统计数据。

里程碑：即使一局死亡，玩家也会因为“解锁了点什么”而想再来一局。

### 阶段 7：打磨、优化与上架准备

**目标**：从“好玩的小 Demo”走向“可以在 Steam 上架的小体量游戏”。  
**对应到 README 其他章节**：
- 利用“性能与调试”章节优化对象池、导航、资源体积。  
- 对照“美术与音效（Art & Audio）”章节，完成首批资产清单中尚未实现的美术与音频内容，为玩家、敌人和关键技能补齐最终使用的模型/动画/特效/BGM/SFX。  
- 补充 VFX/SFX、命中反馈、屏幕震动等手感细节。  
- 根据“导出与版本”与“Steam 上架规划”搭建导出与打包流程。

**里程碑示例**：
- 一局完整流程（从主菜单 → 一局 run → 结算 → 返回主菜单）无明显 bug。  
- 至少有一套稳定的导出配置，可以反复打包并在非开发机上运行。  
- 可以整理一段 30–60 秒的实机演示视频，用于 Steam 商店页和宣传。

> 建议：每完成一个阶段，都在 `docs/` 中写一篇简单的“开发日志/踩坑记录”，既是总结，也是未来扩展或复盘时的参考。

---

## Steam 上架规划

当你完成前文的大部分学习阶段和核心系统搭建后，可以将本项目视为接近可发行的雏形，再逐步推进以下与 Steam 相关的工作：

- **目标平台**：优先支持 Windows PC（Steam），在条件允许时兼容 Steam Deck。  
- **仓库角色**：本仓库作为 Steam 构建的“公开基线工程”，所有关键玩法与系统都会在这里实现和维护，不在仓库中提交具体的 Steam 应用 ID 等敏感配置。  
- **导出与构建**：使用 Godot 4.5 的 Windows 导出预设（`export_presets.cfg`），在接近发售阶段通过脚本/CI（位于 `tools/` 目录）统一打包并产出 Steam 上传所需的可执行与资源文件。  
- **Steam 特性预留**：后续将预留/接入成就、云存档、截图/富状态（Rich Presence）等功能，具体通过 Steamworks SDK（如 GodotSteam 或自定义 GDExtension）集成。  
- **本地化策略**：利用 `localization/` 目录维护多语言文本，至少保证简体中文与英文完整可玩，其他语言视社区贡献和精力扩展。  
- **发布节奏**：推荐在项目中后期建立 `release` 分支，用于与 Steam 正式版本对齐；`main` 分支保持教学与实验性的迭代，必要差异会在 `docs/` 中说明。

在实际推进时，可以按“优先做出一局完整可玩流程 → 打磨核心循环 → 再补内容与美术 → 最后接入 Steam 特性和商业化包装”的顺序，减少返工成本。

---

## 许可证（License）

本项目采用 MIT 协议开源，你可以在满足协议条款的前提下自由地使用、修改和分发本项目的代码与资源。  
完整协议文本见根目录文件：`LICENSE`。
